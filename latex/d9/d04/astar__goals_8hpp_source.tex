\doxysection{astar\+\_\+goals.\+hpp}
\hypertarget{astar__goals_8hpp_source}{}\label{astar__goals_8hpp_source}\index{include/vipra/base\_modules/goals/astar\_goals.hpp@{include/vipra/base\_modules/goals/astar\_goals.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ <algorithm>}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <cstdio>}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <queue>}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ "{}vipra/algorithms/astar.hpp"{}}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}vipra/concepts/goals.hpp"{}}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}vipra/concepts/obstacle\_set.hpp"{}}}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}vipra/data\_structures/graph.hpp"{}}}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}vipra/macros/module.hpp"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}vipra/modules.hpp"{}}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}vipra/types/float.hpp"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}vipra/types/idx.hpp"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}vipra/types/parameter.hpp"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}vipra/types/size.hpp"{}}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}vipra/types/time.hpp"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}vipra/util/debug\_do.hpp"{}}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{keyword}{namespace\ }VIPRA::Goals\ \{}
\DoxyCodeLine{00030\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classVIPRA_1_1Goals_1_1AStar}{AStar}}\ \{}
\DoxyCodeLine{00031\ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00032\ \ \ VIPRA\_MODULE\_TYPE(GOALS);}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \ \ \textcolor{keyword}{template}\ <Concepts::PedsetModule\ pedset\_t,\ Concepts::MapModule\ map\_t>}
\DoxyCodeLine{00035\ \ \ \textcolor{keywordtype}{void}\ initialize(pedset\_t\ \textcolor{keyword}{const}\&\ pedset,\ map\_t\ \textcolor{keyword}{const}\&\ map)\ \{}
\DoxyCodeLine{00036\ \ \ \ \ assert(pedset.num\_pedestrians()\ >\ 0);}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{keyword}{auto}\ \textcolor{keyword}{const}\ pedCnt\ =\ pedset.num\_pedestrians();}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \ \ \ \ \_currentGoals.resize(pedCnt);}
\DoxyCodeLine{00041\ \ \ \ \ \_endGoals.resize(pedCnt);}
\DoxyCodeLine{00042\ \ \ \ \ \_timeSinceLastGoal\ =\ std::vector<VIPRA::f\_pnt>(pedCnt,\ 0);}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \ \ \ \ construct\_graph(map);}
\DoxyCodeLine{00045\ \ \ \ \ set\_end\_goals(pedset,\ map);}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keywordflow}{for}\ (VIPRA::idx\ pedIdx\ =\ 0;\ pedIdx\ <\ pedCnt;\ ++pedIdx)\ \{}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \textcolor{keyword}{const}\ pos\ =\ pedset.ped\_coords(pedIdx);}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ \ \ \ \ VIPRA::idx\ startIdx\ =\ get\_closest\_grid\_idx(pos);}
\DoxyCodeLine{00051\ \ \ \ \ \ \ VIPRA::idx\ endIdx\ =\ get\_closest\_grid\_idx(\_endGoals[pedIdx]);}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_graph.nodes().size()\ <=\ startIdx\ ||\ \_graph.nodes().size()\ <=\ endIdx)\ \{}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Start\ or\ end\ index\ is\ out\ of\ bounds"{}});}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \textcolor{keyword}{const}\ path\ =\ VIPRA::Algo::astar(}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ startIdx,\ endIdx,\ \_graph,}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ [\&](VIPRA::idx\ left,\ VIPRA::idx\ right)\ -\/>\ VIPRA::f\_pnt\ \{}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_graph.data(left).pos.distance\_to(\_graph.data(right).pos);}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \},}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ [\&](VIPRA::idx\ nodeIdx)\ -\/>\ \mbox{\hyperlink{structVIPRA_1_1f3d}{VIPRA::f3d}}\ \{\ \textcolor{keywordflow}{return}\ \_graph.data(nodeIdx).pos;\ \});}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!path)\ \{}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}No\ path\ found\ for\ pedestrian"{}});}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \ \ \ \ \_paths.push\_back(squash\_path(path.value()));}
\DoxyCodeLine{00069\ \ \ \ \ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{keywordflow}{for}\ (VIPRA::idx\ pedIdx\ =\ 0;\ pedIdx\ <\ pedCnt;\ ++pedIdx)\ \{}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \_currentGoals[pedIdx]\ =\ \_paths[pedIdx].back();}
\DoxyCodeLine{00073\ \ \ \ \ \}}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ \ \ assert(\_timeSinceLastGoal.size()\ ==\ pedCnt);}
\DoxyCodeLine{00076\ \ \ \ \ assert(\_currentGoals.size()\ ==\ pedCnt);}
\DoxyCodeLine{00077\ \ \ \ \ assert(\_endGoals.size()\ ==\ pedCnt);}
\DoxyCodeLine{00078\ \ \ \ \ assert(\_paths.size()\ ==\ pedCnt);}
\DoxyCodeLine{00079\ \ \ \}}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ params\_t>}
\DoxyCodeLine{00082\ \ \ \textcolor{keywordtype}{void}\ config(params\_t\ \textcolor{keyword}{const}\&\ params,\ \mbox{\hyperlink{classVIPRA_1_1Random_1_1Engine}{VIPRA::Random::Engine}}\&\ engine)\ \{}
\DoxyCodeLine{00083\ \ \ \ \ \_end\_goal\_type\ =}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ params.template\ get\_param<std::string>(\_VIPRA\_MODULE\_TYPE\_,\ \textcolor{stringliteral}{"{}astar"{}},\ \textcolor{stringliteral}{"{}endGoalType"{}},\ engine);}
\DoxyCodeLine{00085\ \ \ \ \ \_goal\_range\ =\ params.template\ get\_param<VIPRA::f\_pnt>(\_VIPRA\_MODULE\_TYPE\_,\ \textcolor{stringliteral}{"{}astar"{}},\ \textcolor{stringliteral}{"{}goalRange"{}},\ engine);}
\DoxyCodeLine{00086\ \ \ \ \ \_grid\_size\ =\ params.template\ get\_param<VIPRA::f\_pnt>(\_VIPRA\_MODULE\_TYPE\_,\ \textcolor{stringliteral}{"{}astar"{}},\ \textcolor{stringliteral}{"{}gridSize"{}},\ engine);}
\DoxyCodeLine{00087\ \ \ \ \ \_closest\_obstacle\ =}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ params.template\ get\_param<VIPRA::f\_pnt>(\_VIPRA\_MODULE\_TYPE\_,\ \textcolor{stringliteral}{"{}astar"{}},\ \textcolor{stringliteral}{"{}closestObstacle"{}},\ engine);}
\DoxyCodeLine{00089\ \ \ \}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ params\_t>}
\DoxyCodeLine{00092\ \ \ \textcolor{keywordtype}{void}\ register\_params(params\_t\&\ params)\ \{}
\DoxyCodeLine{00093\ \ \ \ \ params.register\_param(\_VIPRA\_MODULE\_TYPE\_,\ \textcolor{stringliteral}{"{}astar"{}},\ \textcolor{stringliteral}{"{}endGoalType"{}});}
\DoxyCodeLine{00094\ \ \ \ \ params.register\_param(\_VIPRA\_MODULE\_TYPE\_,\ \textcolor{stringliteral}{"{}astar"{}},\ \textcolor{stringliteral}{"{}goalRange"{}});}
\DoxyCodeLine{00095\ \ \ \ \ params.register\_param(\_VIPRA\_MODULE\_TYPE\_,\ \textcolor{stringliteral}{"{}astar"{}},\ \textcolor{stringliteral}{"{}gridSize"{}});}
\DoxyCodeLine{00096\ \ \ \ \ params.register\_param(\_VIPRA\_MODULE\_TYPE\_,\ \textcolor{stringliteral}{"{}astar"{}},\ \textcolor{stringliteral}{"{}closestObstacle"{}});}
\DoxyCodeLine{00097\ \ \ \}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ \textcolor{keyword}{template}\ <Concepts::PedsetModule\ pedset\_t,\ Concepts::MapModule\ map\_t>}
\DoxyCodeLine{00100\ \ \ \textcolor{keywordtype}{void}\ update(pedset\_t\ \textcolor{keyword}{const}\&\ pedset,\ map\_t\ \textcolor{keyword}{const}\&\ \textcolor{comment}{/*unused*/},\ VIPRA::delta\_t\ deltaT)\ \{}
\DoxyCodeLine{00101\ \ \ \ \ assert(pedset.num\_pedestrians()\ >\ 0);}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keywordflow}{for}\ (VIPRA::idx\ pedIdx\ =\ 0;\ pedIdx\ <\ pedset.num\_pedestrians();\ ++pedIdx)\ \{}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \textcolor{keyword}{const}\ pos\ =\ pedset.ped\_coords(pedIdx);}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \_timeSinceLastGoal[pedIdx]\ +=\ deltaT;}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pos.distance\_to(\_currentGoals[pedIdx])\ <\ \_goal\_range)\ \{}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_paths[pedIdx].empty())\ \{}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ \ \_currentGoals[pedIdx]\ =\ \_paths[pedIdx].back();}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \ \ \_paths[pedIdx].pop\_back();}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \_timeSinceLastGoal[pedIdx]\ =\ 0.0F;}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00113\ \ \ \ \ \}}
\DoxyCodeLine{00114\ \ \ \}}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \ \ \textcolor{keywordtype}{void}\ change\_end\_goal(VIPRA::idx\ pedIdx,\ \mbox{\hyperlink{structVIPRA_1_1f3d}{VIPRA::f3d}}\ newGoal)\ \{}
\DoxyCodeLine{00117\ \ \ \ \ assert(pedIdx\ <\ \_endGoals.size());}
\DoxyCodeLine{00118\ \ \ \ \ \_endGoals[pedIdx]\ =\ newGoal;}
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{keyword}{auto}\ \textcolor{keyword}{const}\ path\ =\ VIPRA::Algo::astar(}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ get\_closest\_grid\_idx(\_currentGoals[pedIdx]),\ get\_closest\_grid\_idx(\_endGoals[pedIdx]),\ \_graph,}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ [\&](VIPRA::idx\ left,\ VIPRA::idx\ right)\ -\/>\ VIPRA::f\_pnt\ \{}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_graph.data(left).pos.distance\_to(\_graph.data(right).pos);}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \},}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ [\&](VIPRA::idx\ nodeIdx)\ -\/>\ \mbox{\hyperlink{structVIPRA_1_1f3d}{VIPRA::f3d}}\ \{\ \textcolor{keywordflow}{return}\ \_graph.data(nodeIdx).pos;\ \});}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \ \ \ \ \textcolor{keywordflow}{if}\ (!path)\ \{}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}No\ path\ found\ for\ pedestrian"{}});}
\DoxyCodeLine{00128\ \ \ \ \ \}}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \ \ \ \ \_paths[pedIdx]\ =\ squash\_path(*path);}
\DoxyCodeLine{00131\ \ \ \ \ \_currentGoals[pedIdx]\ =\ \_paths[pedIdx].back();}
\DoxyCodeLine{00132\ \ \ \}}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ [[nodiscard]]\ \textcolor{keyword}{auto}\ end\_goals()\ \textcolor{keyword}{const}\ -\/>\ VIPRA::f3dVec\ \textcolor{keyword}{const}\&\ \{\ \textcolor{keywordflow}{return}\ \_endGoals;\ \}}
\DoxyCodeLine{00135\ \ \ [[nodiscard]]\ \textcolor{keyword}{auto}\ current\_goals()\ \textcolor{keyword}{const}\ -\/>\ VIPRA::f3dVec\ \textcolor{keyword}{const}\&\ \{\ \textcolor{keywordflow}{return}\ \_currentGoals;\ \}}
\DoxyCodeLine{00136\ \ \ [[nodiscard]]\ \textcolor{keyword}{auto}\ current\_goal(VIPRA::idx\ pedIdx)\ \textcolor{keyword}{const}\ -\/>\ \mbox{\hyperlink{structVIPRA_1_1f3d}{VIPRA::f3d}}\ \textcolor{keyword}{const}\&\ \{}
\DoxyCodeLine{00137\ \ \ \ \ assert(pedIdx\ <\ \_currentGoals.size());}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordflow}{return}\ \_currentGoals[pedIdx];}
\DoxyCodeLine{00139\ \ \ \}}
\DoxyCodeLine{00140\ \ \ [[nodiscard]]\ \textcolor{keyword}{auto}\ end\_goal(VIPRA::idx\ pedIdx)\ \textcolor{keyword}{const}\ -\/>\ \mbox{\hyperlink{structVIPRA_1_1f3d}{VIPRA::f3d}}\ \textcolor{keyword}{const}\&\ \{}
\DoxyCodeLine{00141\ \ \ \ \ assert(pedIdx\ <\ \_endGoals.size());}
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{keywordflow}{return}\ \_endGoals[pedIdx];}
\DoxyCodeLine{00143\ \ \ \}}
\DoxyCodeLine{00144\ \ \ [[nodiscard]]\ \textcolor{keyword}{auto}\ is\_goal\_met(VIPRA::idx\ pedIdx)\ \textcolor{keyword}{const}\ -\/>\ \textcolor{keywordtype}{bool}\ \{}
\DoxyCodeLine{00145\ \ \ \ \ assert(pedIdx\ <\ \_paths.size());}
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{keywordflow}{return}\ \_paths[pedIdx].empty();}
\DoxyCodeLine{00147\ \ \ \}}
\DoxyCodeLine{00148\ \ \ [[nodiscard]]\ \textcolor{keyword}{auto}\ is\_sim\_goal\_met()\ \textcolor{keyword}{const}\ -\/>\ \textcolor{keywordtype}{bool}\ \{}
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{keywordflow}{return}\ std::all\_of(\_paths.begin(),\ \_paths.end(),\ [](\textcolor{keyword}{auto}\ \textcolor{keyword}{const}\&\ path)\ \{\ return\ path.empty();\ \});}
\DoxyCodeLine{00150\ \ \ \}}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ \ \ [[nodiscard]]\ \textcolor{keyword}{auto}\ time\_since\_last\_goal(VIPRA::idx\ pedIdx)\ \textcolor{keyword}{const}\ -\/>\ VIPRA::f\_pnt\ \{}
\DoxyCodeLine{00153\ \ \ \ \ assert(\_timeSinceLastGoal.size()\ >\ pedIdx);}
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{keywordflow}{return}\ \_timeSinceLastGoal[pedIdx];}
\DoxyCodeLine{00155\ \ \ \}}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00157\ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00158\ \ \ \textcolor{keyword}{struct\ }GridPoint\ \{}
\DoxyCodeLine{00159\ \ \ \ \ \mbox{\hyperlink{structVIPRA_1_1f3d}{VIPRA::f3d}}\ pos;}
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ traversable;}
\DoxyCodeLine{00161\ \ \ \};}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ std::string\ \ \_end\_goal\_type;}
\DoxyCodeLine{00164\ \ \ VIPRA::f\_pnt\ \_goal\_range;}
\DoxyCodeLine{00165\ \ \ VIPRA::f\_pnt\ \_grid\_size;}
\DoxyCodeLine{00166\ \ \ VIPRA::f\_pnt\ \_closest\_obstacle;}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ VIPRA::f3dVec\ \ \ \ \ \ \ \ \ \ \ \ \ \_currentGoals;}
\DoxyCodeLine{00169\ \ \ VIPRA::f3dVec\ \ \ \ \ \ \ \ \ \ \ \ \ \_endGoals;}
\DoxyCodeLine{00170\ \ \ std::vector<VIPRA::f\_pnt>\ \_timeSinceLastGoal;}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ std::vector<std::vector<VIPRA::f3d>>\ \ \ \ \_paths;}
\DoxyCodeLine{00173\ \ \ \mbox{\hyperlink{classVIPRA_1_1DataStructures_1_1Graph}{VIPRA::DataStructures::Graph<GridPoint>}}\ \_graph;}
\DoxyCodeLine{00174\ \ \ VIPRA::size\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_xCount;}
\DoxyCodeLine{00175\ \ \ VIPRA::size\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_yCount;}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00182\ \ \ \textcolor{keywordtype}{void}\ construct\_graph(\mbox{\hyperlink{conceptVIPRA_1_1Concepts_1_1MapModule}{Concepts::MapModule}}\ \textcolor{keyword}{auto}\ \textcolor{keyword}{const}\&\ map)\ \{}
\DoxyCodeLine{00183\ \ \ \ \ set\_grid\_counts(map);}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \ \ assert(\_xCount\ >\ 0\ \&\&\ \_yCount\ >\ 0);}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ \ \ \ \ \_graph.reserve(\_xCount\ *\ \_yCount);}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ \ \ \textcolor{comment}{//\ TODO(rolland):\ This\ starts\ the\ grid\ a\ (0,\ 0)\ and\ not\ the\ bottom\ left\ corner\ of\ the\ map,\ we\ may\ want\ to\ change\ this}}
\DoxyCodeLine{00190\ \ \ \ \ \mbox{\hyperlink{structVIPRA_1_1f3d}{VIPRA::f3d}}\ center;}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00192\ \ \ \ \ \textcolor{keywordflow}{for}\ (VIPRA::idx\ currY\ =\ 0;\ currY\ <\ \_yCount;\ ++currY)\ \{}
\DoxyCodeLine{00193\ \ \ \ \ \ \ center.x\ =\ 0.0F;}
\DoxyCodeLine{00194\ \ \ \ \ \ \ center.y\ +=\ \_grid\_size;}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00196\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (VIPRA::idx\ currX\ =\ 0;\ currX\ <\ \_xCount;\ ++currX)\ \{}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ center.x\ +=\ \_grid\_size;}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ VIPRA::idx\ currIdx\ =\ \_graph.add\_node(}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ GridPoint\{center,\ !map.collision(\mbox{\hyperlink{classVIPRA_1_1Geometry_1_1Circle}{VIPRA::Geometry::Circle}}\{center,\ \_closest\_obstacle\})\});}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_graph.data(currIdx).traversable)\ \{}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ set\_adjacents(currIdx,\ currX,\ currY);}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00207\ \ \ \ \ \}}
\DoxyCodeLine{00208\ \ \ \}}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00217\ \ \ \textcolor{comment}{//\ NOLINTNEXTLINE(bugprone-\/easily-\/swappable-\/parameters)}}
\DoxyCodeLine{00218\ \ \ \textcolor{keywordtype}{void}\ set\_adjacents(VIPRA::idx\ currIdx,\ VIPRA::idx\ currX,\ VIPRA::idx\ currY)\ \{}
\DoxyCodeLine{00219\ \ \ \ \ assert(currIdx\ <\ \_graph.nodes().size());}
\DoxyCodeLine{00220\ \ \ \ \ assert(currX\ <\ \_xCount\ \&\&\ currY\ <\ \_yCount);}
\DoxyCodeLine{00221\ \ \ \ \ assert(\_graph.data(currIdx).traversable\ ==\ \textcolor{keyword}{true});}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00223\ \ \ \ \ \textcolor{keywordflow}{if}\ (currX\ >\ 1)\ \{}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_graph.data(currIdx\ -\/\ 1).traversable)\ \_graph.add\_edge(currIdx,\ currIdx\ -\/\ 1);}
\DoxyCodeLine{00225\ \ \ \ \ \}}
\DoxyCodeLine{00226\ \ \ \ \ \textcolor{keywordflow}{if}\ (currY\ >\ 1)\ \{}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_graph.data(currIdx\ -\/\ \_xCount).traversable)\ \_graph.add\_edge(currIdx,\ currIdx\ -\/\ \_xCount);}
\DoxyCodeLine{00228\ \ \ \ \ \}}
\DoxyCodeLine{00229\ \ \ \ \ \textcolor{keywordflow}{if}\ (currX\ >\ 1\ \&\&\ currY\ >\ 1)\ \{}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_graph.data(currIdx\ -\/\ \_xCount\ -\/\ 1).traversable)\ \_graph.add\_edge(currIdx,\ currIdx\ -\/\ \_xCount\ -\/\ 1);}
\DoxyCodeLine{00231\ \ \ \ \ \}}
\DoxyCodeLine{00232\ \ \ \ \ \textcolor{keywordflow}{if}\ (currX\ <\ \_xCount\ -\/\ 1\ \&\&\ currY\ >\ 1)\ \{}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_graph.data(currIdx\ -\/\ \_xCount\ +\ 1).traversable)\ \_graph.add\_edge(currIdx,\ currIdx\ -\/\ \_xCount\ +\ 1);}
\DoxyCodeLine{00234\ \ \ \ \ \}}
\DoxyCodeLine{00235\ \ \ \}}
\DoxyCodeLine{00236\ }
\DoxyCodeLine{00243\ \ \ \textcolor{keywordtype}{void}\ set\_end\_goals(\mbox{\hyperlink{conceptVIPRA_1_1Concepts_1_1PedsetModule}{Concepts::PedsetModule}}\ \textcolor{keyword}{auto}\ \textcolor{keyword}{const}\&\ pedset,\ \mbox{\hyperlink{conceptVIPRA_1_1Concepts_1_1MapModule}{Concepts::MapModule}}\ \textcolor{keyword}{auto}\ \textcolor{keyword}{const}\&\ map)\ \{}
\DoxyCodeLine{00244\ \ \ \ \ assert(pedset.num\_pedestrians()\ >\ 0);}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00246\ \ \ \ \ \textcolor{keyword}{const}\ VIPRA::size\ pedCnt\ =\ pedset.num\_pedestrians();}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ \ \ \ \ \textcolor{keyword}{auto}\ \textcolor{keyword}{const}\&\ objects\ =\ map.get\_objects(\_end\_goal\_type);}
\DoxyCodeLine{00249\ \ \ \ \ \textcolor{keywordflow}{if}\ (objects.empty())\ \{}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}No\ objects\ of\ type\ "{}}\ +\ \_end\_goal\_type\ +\ \textcolor{stringliteral}{"{}\ found\ in\ map"{}});}
\DoxyCodeLine{00251\ \ \ \ \ \}}
\DoxyCodeLine{00252\ }
\DoxyCodeLine{00253\ \ \ \ \ \textcolor{keywordflow}{for}\ (VIPRA::idx\ pedIdx\ =\ 0;\ pedIdx\ <\ pedCnt;\ ++pedIdx)\ \{}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \textcolor{keyword}{const}\ pos\ =\ pedset.ped\_coords(pedIdx);}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \textcolor{keyword}{const}\ nearestGoal\ =\ get\_nearest\_goal(pos,\ objects);}
\DoxyCodeLine{00257\ }
\DoxyCodeLine{00258\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (nearestGoal\ !=\ objects.end())\ \{}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \_endGoals[pedIdx]\ =\ *nearestGoal;}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}No\ goal\ found\ for\ pedestrian"{}});}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00263\ \ \ \ \ \}}
\DoxyCodeLine{00264\ \ \ \}}
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00272\ \ \ [[nodiscard]]\ \textcolor{keyword}{static}\ \textcolor{keyword}{auto}\ squash\_path(std::vector<VIPRA::f3d>\ \textcolor{keyword}{const}\&\ path)\ -\/>\ std::vector<VIPRA::f3d>\ \{}
\DoxyCodeLine{00273\ \ \ \ \ assert(path.empty()\ ==\ \textcolor{keyword}{false});}
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00275\ \ \ \ \ std::vector<VIPRA::f3d>\ squashedPath;}
\DoxyCodeLine{00276\ \ \ \ \ squashedPath.reserve(path.size()\ /\ 2);}
\DoxyCodeLine{00277\ }
\DoxyCodeLine{00278\ \ \ \ \ \mbox{\hyperlink{structVIPRA_1_1f3d}{VIPRA::f3d}}\ dif;}
\DoxyCodeLine{00279\ \ \ \ \ \textcolor{keywordflow}{for}\ (VIPRA::idx\ i\ =\ 1;\ i\ <\ path.size();\ ++i)\ \{}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ currDif\ =\ path[i]\ -\/\ path[i\ -\/\ 1];}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (currDif\ !=\ dif)\ \{}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ squashedPath.push\_back(path[i\ -\/\ 1]);}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ dif\ =\ currDif;}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00285\ \ \ \ \ \}}
\DoxyCodeLine{00286\ }
\DoxyCodeLine{00287\ \ \ \ \ \textcolor{keywordflow}{return}\ squashedPath;}
\DoxyCodeLine{00288\ \ \ \}}
\DoxyCodeLine{00289\ }
\DoxyCodeLine{00298\ \ \ [[nodiscard]]\ \textcolor{keyword}{static}\ \textcolor{keyword}{auto}\ get\_index(VIPRA::size\ gridX,\ VIPRA::size\ gridY,\ VIPRA::size\ xCount)\ \textcolor{keyword}{noexcept}}
\DoxyCodeLine{00299\ \ \ \ \ \ \ -\/>\ VIPRA::idx\ \{}
\DoxyCodeLine{00300\ \ \ \ \ \textcolor{keywordflow}{return}\ gridX\ +\ (gridY\ *\ xCount);}
\DoxyCodeLine{00301\ \ \ \}}
\DoxyCodeLine{00302\ }
\DoxyCodeLine{00310\ \ \ [[nodiscard]]\ \textcolor{keyword}{static}\ \textcolor{keyword}{auto}\ get\_nearest\_goal(\mbox{\hyperlink{structVIPRA_1_1f3d}{VIPRA::f3d}}\ pos,\ std::vector<VIPRA::f3d>\ \textcolor{keyword}{const}\&\ goals)}
\DoxyCodeLine{00311\ \ \ \ \ \ \ -\/>\ VIPRA::f3dVec::const\_iterator\ \{}
\DoxyCodeLine{00312\ \ \ \ \ assert(goals.empty()\ ==\ \textcolor{keyword}{false});}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ \ \ \textcolor{keywordflow}{return}\ std::min\_element(goals.begin(),\ goals.end(),\ [\&](\textcolor{keyword}{auto}\ \textcolor{keyword}{const}\&\ left,\ \textcolor{keyword}{auto}\ \textcolor{keyword}{const}\&\ right)\ \{}
\DoxyCodeLine{00315\ \ \ \ \ \ \ return\ pos.distance\_to(left)\ <\ pos.distance\_to(right);}
\DoxyCodeLine{00316\ \ \ \ \ \});}
\DoxyCodeLine{00317\ \ \ \}}
\DoxyCodeLine{00318\ }
\DoxyCodeLine{00325\ \ \ [[nodiscard]]\ \textcolor{keyword}{auto}\ get\_closest\_grid\_idx(\mbox{\hyperlink{structVIPRA_1_1f3d}{VIPRA::f3d}}\ pos)\ \textcolor{keyword}{const}\ -\/>\ VIPRA::idx\ \{}
\DoxyCodeLine{00326\ \ \ \ \ \textcolor{keyword}{auto}\ gridX\ =\ \textcolor{keyword}{static\_cast<}VIPRA::idx\textcolor{keyword}{>}(std::floor(pos.x\ /\ \_grid\_size));}
\DoxyCodeLine{00327\ \ \ \ \ \textcolor{keyword}{auto}\ gridY\ =\ \textcolor{keyword}{static\_cast<}VIPRA::idx\textcolor{keyword}{>}(std::floor(pos.y\ /\ \_grid\_size));}
\DoxyCodeLine{00328\ }
\DoxyCodeLine{00329\ \ \ \ \ \textcolor{keyword}{auto}\ \textcolor{keyword}{const}\ idx\ =\ get\_index(gridX,\ gridY,\ \_xCount);}
\DoxyCodeLine{00330\ }
\DoxyCodeLine{00331\ \ \ \ \ \textcolor{keywordflow}{if}\ (idx\ >=\ \_graph.nodes().size())\ \{}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Grid\ index\ is\ out\ of\ bounds"{}});}
\DoxyCodeLine{00333\ \ \ \ \ \}}
\DoxyCodeLine{00334\ }
\DoxyCodeLine{00335\ \ \ \ \ \textcolor{keywordflow}{return}\ idx;}
\DoxyCodeLine{00336\ \ \ \}}
\DoxyCodeLine{00337\ }
\DoxyCodeLine{00343\ \ \ \textcolor{keywordtype}{void}\ set\_grid\_counts(\textcolor{keyword}{const}\ \mbox{\hyperlink{conceptVIPRA_1_1Concepts_1_1MapModule}{Concepts::MapModule}}\ \textcolor{keyword}{auto}\&\ map)\ \{}
\DoxyCodeLine{00344\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structVIPRA_1_1f3d}{VIPRA::f3d}}\ dimensions\ =\ map.get\_dimensions();}
\DoxyCodeLine{00345\ }
\DoxyCodeLine{00346\ \ \ \ \ assert(dimensions.x\ >\ 0\ \&\&\ dimensions.y\ >\ 0);}
\DoxyCodeLine{00347\ \ \ \ \ assert(\_grid\_size\ >\ 0\ \&\&\ \_closest\_obstacle\ >\ 0);}
\DoxyCodeLine{00348\ }
\DoxyCodeLine{00349\ \ \ \ \ \_xCount\ =\ \textcolor{keyword}{static\_cast<}VIPRA::idx\textcolor{keyword}{>}(std::ceil(dimensions.x\ /\ \_grid\_size)\ +\ 1);}
\DoxyCodeLine{00350\ \ \ \ \ \_yCount\ =\ \textcolor{keyword}{static\_cast<}VIPRA::idx\textcolor{keyword}{>}(std::ceil(dimensions.y\ /\ \_grid\_size)\ +\ 1);}
\DoxyCodeLine{00351\ \ \ \}}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00353\ \ \ \textcolor{comment}{//\ void\ debug\_output\_paths()\ \{}}
\DoxyCodeLine{00354\ \ \ \textcolor{comment}{//\ \ \ std::printf("{}\{\(\backslash\)"{}paths\(\backslash\)"{}:\ [\(\backslash\)n"{});}}
\DoxyCodeLine{00355\ \ \ \textcolor{comment}{//\ \ \ for\ (auto\ const\&\ path\ :\ \_paths)\ \{}}
\DoxyCodeLine{00356\ \ \ \textcolor{comment}{//\ \ \ \ \ std::printf("{}\{\ \(\backslash\)"{}points\(\backslash\)"{}:\ [\(\backslash\)n"{});}}
\DoxyCodeLine{00357\ \ \ \textcolor{comment}{//\ \ \ \ \ for\ (auto\ const\&\ point\ :\ path)\ \{}}
\DoxyCodeLine{00358\ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ std::printf("{}[\%f,\ \%f,\ \%f]\%c\(\backslash\)n"{},\ point.x,\ point.y,\ point.z,\ point\ ==\ path.back()\ ?\ '\ '\ :\ ',');}}
\DoxyCodeLine{00359\ \ \ \textcolor{comment}{//\ \ \ \ \ \}}}
\DoxyCodeLine{00360\ \ \ \textcolor{comment}{//\ \ \ \ \ std::printf("{}]\}\%c\(\backslash\)n"{},\ \&path\ ==\ \&\_paths.back()\ ?\ '\ '\ :\ ',');}}
\DoxyCodeLine{00361\ \ \ \textcolor{comment}{//\ \ \ \}}}
\DoxyCodeLine{00362\ \ \ \textcolor{comment}{//\ \ \ std::printf("{}]\}\(\backslash\)n"{});}}
\DoxyCodeLine{00363\ \ \ \textcolor{comment}{//\ \ \ std::fflush(stdout);}}
\DoxyCodeLine{00364\ \ \ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{00365\ \};}
\DoxyCodeLine{00366\ \}\ \ \textcolor{comment}{//\ namespace\ VIPRA::Goals}}
\DoxyCodeLine{00367\ }
\DoxyCodeLine{00368\ CHECK\_MODULE(GoalsModule,\ \mbox{\hyperlink{classVIPRA_1_1Goals_1_1AStar}{VIPRA::Goals::AStar}})}

\end{DoxyCode}
