<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VIPRA Documentation: VIPRA Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">VIPRA Documentation
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">VIPRA Documentation </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md0">Introduction</a></li>
<li class="level1"><a href="#autotoc_md1">Usage</a><ul><li class="level2"><a href="#autotoc_md2">Standalone Build</a></li>
<li class="level2"><a href="#autotoc_md3">Library</a></li>
<li class="level2"><a href="#autotoc_md4">Simulation Construction</a><ul><li class="level3"><a href="#autotoc_md5">Required Modules</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md7">Example Simulation</a></li>
<li class="level2"><a href="#autotoc_md8">Example Parameter Sweep</a></li>
<li class="level2"><a href="#autotoc_md9">Module Parameters</a></li>
<li class="level2"><a href="#autotoc_md11">Included Modules</a><ul><li class="level3"><a href="#autotoc_md13">Calm Model</a><ul><li class="level4"><a href="#autotoc_md14">Use:</a></li>
<li class="level4"><a href="#autotoc_md15">Parameters:</a></li>
</ul>
</li>
<li class="level3"><a href="#autotoc_md16">AStar Goals</a><ul><li class="level4"><a href="#autotoc_md17">Use:</a></li>
<li class="level4"><a href="#autotoc_md18">Parameters:</a></li>
</ul>
</li>
<li class="level3"><a href="#autotoc_md19">QuadTree Obstacle Set</a><ul><li class="level4"><a href="#autotoc_md20">Use:</a></li>
<li class="level4"><a href="#autotoc_md21">Parameters:</a></li>
</ul>
</li>
<li class="level3"><a href="#autotoc_md22">Grid Pedestrian Set</a><ul><li class="level4"><a href="#autotoc_md23">Use:</a></li>
<li class="level4"><a href="#autotoc_md24">Parameters:</a></li>
</ul>
</li>
<li class="level3"><a href="#autotoc_md25">JSON Input</a><ul><li class="level4"><a href="#autotoc_md26">Use:</a></li>
<li class="level4"><a href="#autotoc_md27">Parameters:</a></li>
</ul>
</li>
<li class="level3"><a href="#autotoc_md28">JSON Output</a><ul><li class="level4"><a href="#autotoc_md29">Use:</a></li>
<li class="level4"><a href="#autotoc_md30">Parameters:</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md32">Common Errors</a></li>
<li class="level1"><a href="#autotoc_md34">Development</a></li>
<li class="level1"><a href="#autotoc_md35">Overview</a><ul><li class="level2"><a href="#autotoc_md36">Simulation</a><ul><li class="level3"><a href="#autotoc_md37">Simulation Steps</a><ul><li class="level4"><a href="#autotoc_md38">1. VIPRA::simulation</a></li>
<li class="level4"><a href="#autotoc_md39">2. Run Sim</a></li>
<li class="level4"><a href="#autotoc_md40">3. Parameters Loaded</a></li>
<li class="level4"><a href="#autotoc_md41">4. Parameters Registered</a></li>
<li class="level4"><a href="#autotoc_md42">5. Modules Configured</a></li>
<li class="level4"><a href="#autotoc_md43">6. Modules Initialized</a></li>
<li class="level4"><a href="#autotoc_md44">7. Simulation Run</a></li>
<li class="level4"><a href="#autotoc_md45">8. Output</a></li>
</ul>
</li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md46">Module Types</a></li>
<li class="level2"><a href="#autotoc_md47">Parameter Sweep</a></li>
<li class="level2"><a href="#autotoc_md48">Randomization</a></li>
<li class="level2"><a href="#autotoc_md49">VIPRA Types</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md50">Module Implementation</a></li>
<li class="level1"><a href="#autotoc_md51">Base Module Implementation</a><ul><ul><li class="level3"><a href="#autotoc_md52">Interface</a></li>
</ul>
</ul>
</li>
<li class="level1"><a href="#autotoc_md53">Model Implementation</a><ul><ul><li class="level3"><a href="#autotoc_md54">Interface</a></li>
</ul>
</ul>
</li>
<li class="level1"><a href="#autotoc_md55">Goals Implementation</a><ul><ul><li class="level3"><a href="#autotoc_md56">Interface</a></li>
</ul>
</ul>
</li>
<li class="level1"><a href="#autotoc_md57">Obstacle Set Implementation</a><ul><ul><li class="level3"><a href="#autotoc_md58">Interface</a></li>
</ul>
</ul>
</li>
<li class="level1"><a href="#autotoc_md59">Pedestrian Set Implementation</a><ul><ul><li class="level3"><a href="#autotoc_md60">Interface</a></li>
</ul>
</ul>
</li>
<li class="level1"><a href="#autotoc_md61">Input Implementation</a><ul><ul><li class="level3"><a href="#autotoc_md62">Interface</a><ul><li class="level4"><a href="#autotoc_md63">Serializable Input Implementation</a></li>
<li class="level4"><a href="#autotoc_md64">Parameter Input Implementation</a></li>
<li class="level4"><a href="#autotoc_md65">Polygon Input Implementation</a></li>
</ul>
</li>
</ul>
</ul>
</li>
<li class="level1"><a href="#autotoc_md66">Output Implementation</a><ul><ul><li class="level3"><a href="#autotoc_md67">Interface</a></li>
</ul>
</ul>
</li>
<li class="level1"><a href="#autotoc_md69">Model Implementation Example</a></li>
<li class="level1"><a href="#autotoc_md71">Macros</a><ul><li class="level2"><a href="#autotoc_md72">Base Module Macros</a><ul><ul><li class="level4"><a href="#autotoc_md73">VIPRA_MODULE_TYPE(type)</a></li>
<li class="level4"><a href="#autotoc_md74">VIPRA_MODULE_NAME(name)</a></li>
<li class="level4"><a href="#autotoc_md75">CHECK_MODULE(type, class)</a></li>
<li class="level4"><a href="#autotoc_md76">VIPRA_REGISTER_STEP</a></li>
<li class="level4"><a href="#autotoc_md77">VIPRA_REGISTER_PARAM</a></li>
<li class="level4"><a href="#autotoc_md78">VIPRA_CONFIG_STEP</a></li>
<li class="level4"><a href="#autotoc_md79">VIPRA_GET_PARAM</a></li>
<li class="level4"><a href="#autotoc_md80">VIPRA_GET_ARRAY_PARAM</a></li>
</ul>
</ul>
</li>
<li class="level2"><a href="#autotoc_md81">Model Macros</a><ul><ul><li class="level4"><a href="#autotoc_md82">VIPRA_MODEL_INIT_STEP</a></li>
<li class="level4"><a href="#autotoc_md83">VIPRA_MODEL_TIMESTEP</a></li>
</ul>
</ul>
</li>
<li class="level2"><a href="#autotoc_md84">Goals Macros</a><ul><ul><li class="level4"><a href="#autotoc_md85">VIPRA_GOALS_INIT_STEP</a></li>
</ul>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md86">Algorithms</a></li>
<li class="level1"><a href="#autotoc_md87">Data Structures</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_docs_2docs"></a></p>
<h1><a class="anchor" id="autotoc_md0"></a>
Introduction</h1>
<p>This project provides tools for interdisciplinary analysis of fine-scaled pedestrian movement, especially for science-based decision-making. It is motivated by the fact that local movement and interaction patterns of individuals congregated in public locations, such as entertainment venues and transportation hubs, impacts public health in myriad ways. For instance, infectious disease transmission in crowded areas, such as the 2016 measles outbreak in Disney world that resulted in 125 cases, is affected by the evolution of the pedestrian contact network.</p>
<p>In such contexts, mathematical models can be used to explore different “what if” scenarios for planning public health interventions. For example, pedestrian mobility models could help in the design of public spaces and policies that reduce contacts to mitigate disease spread or encourage walking to improve health outcomes. Understanding the fine-scale movement and interaction patterns of people can help design effective policies and spatial layouts to better engineer suitable movement and interaction patterns for improved public health outcomes in several domains.</p>
<p>Pedestrian dynamics enables such analysis by simulating the trajectories of individual pedestrians in a crowd. Such movement is impacted by behavioral characteristics of humans, policy choices of decisions makers, and design decisions regarding the built environment. Furthermore, the impact of pedestrian dynamics is governed by application-domain models, such as infection spread models. Thus, input from a variety of science domains is required to produce comprehensive understanding for science-based decision-making.</p>
<p>This project includes a modular pedestrian dynamics code to which input from different domains could be easily included. In addition, it includes tools to democratize use by users with limited computing background by including a domain specific language to specify human behavior and policy. We also separately provide a recommender system, as a complementary project, to suggested suitable models to use.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Usage</h1>
<p>VIPRA can either be used as a Library for use in other projects or built as a Standalone Simulation.</p>
<p>There is an Example Simulation below.</p>
<h2><a class="anchor" id="autotoc_md2"></a>
Standalone Build</h2>
<p>The <code>VIPRA</code> repository comes with a ready <code>main.cpp</code> that follows the Example Simulation below.</p>
<p>To build the simulation, in the parent directory run: </p><div class="fragment"><div class="line">make</div>
</div><!-- fragment --><p>The example simulation provided can be run with: </p><div class="fragment"><div class="line">./VIPRA</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3"></a>
Library</h2>
<p><code>VIPRA</code> can be included in a project using <a href="https://cmake.org/">CMake</a></p>
<div class="fragment"><div class="line">target_link_libraries(</div>
<div class="line">  **project**</div>
<div class="line">  PUBLIC</div>
<div class="line">  VIPRA</div>
<div class="line">)</div>
</div><!-- fragment --><ul>
<li>Replace <code>**project**</code> with the name of your CMake project</li>
</ul>
<h2><a class="anchor" id="autotoc_md4"></a>
Simulation Construction</h2>
<p>Simulations are created by choosing which implementations to use for the several different Module Types.</p>
<p>A utility function for creating simulations is provided that allows the modules to be passed in in any order: </p><div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span>... module_ts&gt;</div>
<div class="line"><span class="keyword">auto</span> VIPRA::simulation(module_ts&amp;&amp;...) -&gt; <a class="code hl_class" href="da/d73/classVIPRA_1_1SimType.html">VIPRA::SimType</a>;</div>
<div class="ttc" id="aclassVIPRA_1_1SimType_html"><div class="ttname"><a href="da/d73/classVIPRA_1_1SimType.html">VIPRA::SimType</a></div><div class="ttdef"><b>Definition</b> sim_type.hpp:31</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md5"></a>
Required Modules</h3>
<p>Each simulation requires the following modules:</p><ul>
<li><code>Model</code></li>
<li><code>Goals</code></li>
<li><code>Pedestrian Set</code></li>
<li><code>Map</code><ul>
<li><code>Obstacle Set</code></li>
<li><code>Polygon Input</code></li>
</ul>
</li>
<li><code>Output Coordinator</code><ul>
<li><code>Output</code> (Can have any number of Output modules)</li>
</ul>
</li>
</ul>
<p><code>Maps</code> and <code>Output Coordinators</code> are special in that they require modules themselves (denoted by the additional indent)</p>
<hr  />
<h2><a class="anchor" id="autotoc_md7"></a>
Example Simulation</h2>
<p>Below is an example main that uses some of the module implementations that are shipped with VIPRA.</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="preprocessor">#include &lt;vipra.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;modules/model/calm_model/calm_model.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> main() -&gt; <span class="keywordtype">int</span> {</div>
<div class="line">  <span class="comment">// Create the simulation, modules can be placed in any order so long as all are provided/valid</span></div>
<div class="line">  <span class="keyword">auto</span> sim = VIPRA::simulation(</div>
<div class="line">      <a class="code hl_class" href="da/de5/classCALM_1_1Model.html">CALM::Model</a>{},                          <span class="comment">// Pedestrian Dynamics Model</span></div>
<div class="line">      <a class="code hl_class" href="d8/d10/classVIPRA_1_1Goals_1_1AStar.html">VIPRA::Goals::AStar</a>{},                  <span class="comment">// Goals Module</span></div>
<div class="line">      <a class="code hl_class" href="d8/df7/classVIPRA_1_1Pedestrians_1_1Grid.html">VIPRA::Pedestrians::Grid</a>{               <span class="comment">// Pedestrian Set Module</span></div>
<div class="line">          <a class="code hl_class" href="d1/d4b/classVIPRA_1_1Input_1_1JSON.html">VIPRA::Input::JSON</a>{<span class="stringliteral">&quot;maps/pedestrians/a320/a320_144_pedestrians.json&quot;</span>}, <span class="comment">// Input Module</span></div>
<div class="line">      },</div>
<div class="line">      <a class="code hl_class" href="d1/dd7/classVIPRA_1_1Module_1_1Output.html">VIPRA::Module::Output</a>{                  <span class="comment">// Output Coordinator</span></div>
<div class="line">        <a class="code hl_class" href="d1/d14/classVIPRA_1_1Output_1_1Trajectories_1_1JSON.html">VIPRA::Output::Trajectories::JSON</a>{}   <span class="comment">// Output Module</span></div>
<div class="line">      },</div>
<div class="line">      <a class="code hl_class" href="d2/d41/classVIPRA_1_1Module_1_1Map.html">VIPRA::Module::Map</a>{                     <span class="comment">// Map Coordinator</span></div>
<div class="line">        <a class="code hl_class" href="d1/d4b/classVIPRA_1_1Input_1_1JSON.html">VIPRA::Input::JSON</a>{<span class="stringliteral">&quot;maps/obstacles/a320/a320_polygons.json&quot;</span>}, <span class="comment">// Input Module (Polygon Input)</span></div>
<div class="line">        <a class="code hl_class" href="d7/dc5/classVIPRA_1_1Obstacles_1_1QuadTree.html">VIPRA::Obstacles::QuadTree</a>{}          <span class="comment">// Obstacle Set Module</span></div>
<div class="line">      }</div>
<div class="line">  );</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Run the simulation, passing in parameters</span></div>
<div class="line">  sim(</div>
<div class="line">    <a class="code hl_class" href="dd/d44/classVIPRA_1_1Parameters.html">VIPRA::Parameters</a>{</div>
<div class="line">      <a class="code hl_class" href="d1/d4b/classVIPRA_1_1Input_1_1JSON.html">VIPRA::Input::JSON</a>{<span class="stringliteral">&quot;module_params.json&quot;</span>}</div>
<div class="line">    }</div>
<div class="line">  );</div>
<div class="line">}</div>
<div class="ttc" id="aclassCALM_1_1Model_html"><div class="ttname"><a href="da/de5/classCALM_1_1Model.html">CALM::Model</a></div><div class="ttdef"><b>Definition</b> calm_model.hpp:12</div></div>
<div class="ttc" id="aclassVIPRA_1_1Goals_1_1AStar_html"><div class="ttname"><a href="d8/d10/classVIPRA_1_1Goals_1_1AStar.html">VIPRA::Goals::AStar</a></div><div class="ttdoc">Goals module that uses the A* algorithm to find the path to the goal.</div><div class="ttdef"><b>Definition</b> astar_goals.hpp:30</div></div>
<div class="ttc" id="aclassVIPRA_1_1Input_1_1JSON_html"><div class="ttname"><a href="d1/d4b/classVIPRA_1_1Input_1_1JSON.html">VIPRA::Input::JSON</a></div><div class="ttdoc">Parameter and Polygon qualified JSON input module.</div><div class="ttdef"><b>Definition</b> json_input.hpp:38</div></div>
<div class="ttc" id="aclassVIPRA_1_1Module_1_1Map_html"><div class="ttname"><a href="d2/d41/classVIPRA_1_1Module_1_1Map.html">VIPRA::Module::Map</a></div><div class="ttdef"><b>Definition</b> map.hpp:20</div></div>
<div class="ttc" id="aclassVIPRA_1_1Module_1_1Output_html"><div class="ttname"><a href="d1/dd7/classVIPRA_1_1Module_1_1Output.html">VIPRA::Module::Output</a></div><div class="ttdef"><b>Definition</b> output.hpp:15</div></div>
<div class="ttc" id="aclassVIPRA_1_1Obstacles_1_1QuadTree_html"><div class="ttname"><a href="d7/dc5/classVIPRA_1_1Obstacles_1_1QuadTree.html">VIPRA::Obstacles::QuadTree</a></div><div class="ttdoc">Obstacle module that uses a quadtree to store obstacles.</div><div class="ttdef"><b>Definition</b> quad_tree.hpp:25</div></div>
<div class="ttc" id="aclassVIPRA_1_1Output_1_1Trajectories_1_1JSON_html"><div class="ttname"><a href="d1/d14/classVIPRA_1_1Output_1_1Trajectories_1_1JSON.html">VIPRA::Output::Trajectories::JSON</a></div><div class="ttdoc">JSON output module for writing trajectories to a JSON file.</div><div class="ttdef"><b>Definition</b> json_output.hpp:20</div></div>
<div class="ttc" id="aclassVIPRA_1_1Parameters_html"><div class="ttname"><a href="dd/d44/classVIPRA_1_1Parameters.html">VIPRA::Parameters</a></div><div class="ttdef"><b>Definition</b> parameters.hpp:23</div></div>
<div class="ttc" id="aclassVIPRA_1_1Pedestrians_1_1Grid_html"><div class="ttname"><a href="d8/df7/classVIPRA_1_1Pedestrians_1_1Grid.html">VIPRA::Pedestrians::Grid</a></div><div class="ttdoc">Pedestrian module that uses a grid to store pedestrians.</div><div class="ttdef"><b>Definition</b> grid.hpp:26</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md8"></a>
Example Parameter Sweep</h2>
<p>This example uses the parameter sweep engine.</p>
<p>It takes in the total number of simulations to run as a command line argument.</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="preprocessor">#include &lt;vipra.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;modules/model/calm_model/calm_model.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv) -&gt; <span class="keywordtype">int</span> {</div>
<div class="line">  VIPRA::ParameterSweep::initialize(argc, argv);  <span class="comment">// Initialize the parameter sweep engine</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (argc != 2) {      <span class="comment">// Read in the command line arguments for the number of simulations to run</span></div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Usage: &quot;</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">&quot; &lt;simCount&gt;&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">size_t</span> simCount = std::stoul(argv[1]);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> sim = VIPRA::simulation(     <span class="comment">// Create the simulation</span></div>
<div class="line">      <a class="code hl_class" href="da/de5/classCALM_1_1Model.html">CALM::Model</a>{}, </div>
<div class="line">      <a class="code hl_class" href="d8/d10/classVIPRA_1_1Goals_1_1AStar.html">VIPRA::Goals::AStar</a>{},</div>
<div class="line">      <a class="code hl_class" href="d8/df7/classVIPRA_1_1Pedestrians_1_1Grid.html">VIPRA::Pedestrians::Grid</a>{</div>
<div class="line">          <a class="code hl_class" href="d1/d4b/classVIPRA_1_1Input_1_1JSON.html">VIPRA::Input::JSON</a>{<span class="stringliteral">&quot;maps/pedestrians/a320/a320_144_pedestrians.json&quot;</span>},</div>
<div class="line">      },</div>
<div class="line">      <a class="code hl_class" href="d1/dd7/classVIPRA_1_1Module_1_1Output.html">VIPRA::Module::Output</a>{<a class="code hl_class" href="d1/d14/classVIPRA_1_1Output_1_1Trajectories_1_1JSON.html">VIPRA::Output::Trajectories::JSON</a>{}},</div>
<div class="line">      <a class="code hl_class" href="d2/d41/classVIPRA_1_1Module_1_1Map.html">VIPRA::Module::Map</a>{</div>
<div class="line">        <a class="code hl_class" href="d1/d4b/classVIPRA_1_1Input_1_1JSON.html">VIPRA::Input::JSON</a>{<span class="stringliteral">&quot;maps/obstacles/a320/a320_polygons.json&quot;</span>},</div>
<div class="line">        <a class="code hl_class" href="d7/dc5/classVIPRA_1_1Obstacles_1_1QuadTree.html">VIPRA::Obstacles::QuadTree</a>{}</div>
<div class="line">      });</div>
<div class="line"> </div>
<div class="line">  VIPRA::ParameterSweep::run(    <span class="comment">// Run a parameter sweep</span></div>
<div class="line">      sim,                       <span class="comment">// Simulation to run</span></div>
<div class="line">      <a class="code hl_class" href="dd/d44/classVIPRA_1_1Parameters.html">VIPRA::Parameters</a>{<a class="code hl_class" href="d1/d4b/classVIPRA_1_1Input_1_1JSON.html">VIPRA::Input::JSON</a>{<span class="stringliteral">&quot;module_params.json&quot;</span>}}, <span class="comment">// Module Parameters</span></div>
<div class="line">      simCount,                  <span class="comment">// Number of simulations</span></div>
<div class="line">      []() { std::cout &lt;&lt; <span class="stringliteral">&quot;Simulation complete on: &quot;</span> &lt;&lt; VIPRA::ParameterSweep::get_rank() &lt;&lt; std::endl; } <span class="comment">// Optional: callback for each simulation run</span></div>
<div class="line">  );</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md9"></a>
Module Parameters</h2>
<p>Parameters are loaded into each module before they are initizalized. The exact steps of a simulation run are shown in `Simluation Steps`.</p>
<p>Parameters can use any `Parameter Input` module, the `JSON` input module provided works for this.</p>
<p>The format for JSON parameters is: </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;module type&quot;: {</div>
<div class="line">    &quot;module name&quot;: {</div>
<div class="line">      &quot;parameter name&quot;: &quot;parameter value&quot;</div>
<div class="line">    }</div>
<div class="line">  },</div>
<div class="line">  ...</div>
<div class="line">}</div>
</div><!-- fragment --><p>Example of a `Goals` module parameters: </p><div class="fragment"><div class="line">{</div>
<div class="line">  ...</div>
<div class="line">  &quot;goals&quot;: {                  // Module Type</div>
<div class="line">    &quot;astar&quot;: {                // Module Name</div>
<div class="line">      &quot;endGoalType&quot;: &quot;exit&quot;,  // Parameter values</div>
<div class="line">      &quot;gridSize&quot;: 0.1,</div>
<div class="line">      &quot;closestObstacle&quot;: 0.25,</div>
<div class="line">      &quot;goalRange&quot;: 0.05</div>
<div class="line">    }</div>
<div class="line">  },</div>
<div class="line">  ...</div>
<div class="line">}</div>
</div><!-- fragment --> <hr  />
<h2><a class="anchor" id="autotoc_md11"></a>
Included Modules</h2>
<p>There are several modules included with VIPRA.</p>
<p><b>Model</b>:</p><ul>
<li>`Calm Model`</li>
</ul>
<p><b>Goals</b>:</p><ul>
<li>`AStar`</li>
</ul>
<p><b>Obstacle Set</b>:</p><ul>
<li>`QuadTree`</li>
</ul>
<p><b>Pedestrian Set</b>:</p><ul>
<li>`Grid`</li>
</ul>
<p><b>Input</b>:</p><ul>
<li>`JSON`</li>
</ul>
<p><b>Output</b>:</p><ul>
<li>`JSON`</li>
</ul>
<hr  />
<h3><a class="anchor" id="autotoc_md13"></a>
Calm Model</h3>
<p>This <code>Model</code> module implements the <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0229690">Calm Model</a></p>
<h4><a class="anchor" id="autotoc_md14"></a>
Use:</h4>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="preprocessor">#include &quot;modules/model/calm_model/calm_model.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line">VIPRA::simulation(</div>
<div class="line">  ...</div>
<div class="line">  <a class="code hl_class" href="da/de5/classCALM_1_1Model.html">CALM::Model</a>{},</div>
<div class="line">  ...</div>
<div class="line">);</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md15"></a>
Parameters:</h4>
<ul>
<li><code>meanMass</code> : Mean mass for population</li>
<li><code>massStdDev</code> : Standard Deviation for mass</li>
<li><code>meanReactionTime</code> : Mean reaction time for population</li>
<li><code>reactionTimeStdDev</code> : Standard Deviation for reaction time</li>
<li><code>meanMaxSpeed</code> : Mean max speed for population</li>
<li><code>maxSpeedStdDev</code> : Standard deviation for max speed</li>
<li><code>meanShoulderLen</code> : Mean shoulder length for population</li>
<li><code>shoulderLenStdDev</code> : Standard deviation for shoulder length</li>
</ul>
<h3><a class="anchor" id="autotoc_md16"></a>
AStar Goals</h3>
<p>This <code>Goals</code> module uses the A* algorithm to find paths for each pedestrian.</p>
<h4><a class="anchor" id="autotoc_md17"></a>
Use:</h4>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="preprocessor">#include &quot;vipra.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line">VIPRA::simulation(</div>
<div class="line">  ...</div>
<div class="line">  <a class="code hl_class" href="d8/d10/classVIPRA_1_1Goals_1_1AStar.html">VIPRA::Goals::AStar</a>{},</div>
<div class="line">  ...</div>
<div class="line">);</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md18"></a>
Parameters:</h4>
<ul>
<li><code>endGoalType</code> : Name of object in map each pedestrian tries to reach (e.g. "exit")</li>
<li><code>goalRange</code> : Range, in meters, before a goal is counted as "reached" (e.g. 0.05)</li>
<li><code>gridSize</code> : Length of each side, in meters, of each grid in the pathing graph (e.g. 0.1)</li>
<li><code>closestObstacle</code> : Closest a grid center can be to an obstacle before being considered non-traversable</li>
</ul>
<h3><a class="anchor" id="autotoc_md19"></a>
QuadTree Obstacle Set</h3>
<p>This <code>Obstacle Set</code> module uses the Quad Tree to hold the map geometry.</p>
<h4><a class="anchor" id="autotoc_md20"></a>
Use:</h4>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="preprocessor">#include &quot;vipra.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line">VIPRA::simulation(</div>
<div class="line">  ...</div>
<div class="line">  <a class="code hl_class" href="d2/d41/classVIPRA_1_1Module_1_1Map.html">VIPRA::Module::Map</a>{</div>
<div class="line">    <a class="code hl_class" href="d1/d4b/classVIPRA_1_1Input_1_1JSON.html">VIPRA::Input::JSON</a>{<span class="stringliteral">&quot;filepath&quot;</span>} <span class="comment">// Map requires an Input module</span></div>
<div class="line">    <a class="code hl_class" href="d7/dc5/classVIPRA_1_1Obstacles_1_1QuadTree.html">VIPRA::Obstacles::QuadTree</a>{} <span class="comment">// Obstacle sets go inside the Map module</span></div>
<div class="line">  }</div>
<div class="line">  ...</div>
<div class="line">)</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md21"></a>
Parameters:</h4>
<ul>
<li><code>minQuadSize</code> : Size at which quads stop being subdivided</li>
</ul>
<h3><a class="anchor" id="autotoc_md22"></a>
Grid Pedestrian Set</h3>
<p>This <code>Pedestrian Set</code> module holds pedestrians in a grid of cells, allowing for more efficient lookup of nearest neighbors</p>
<h4><a class="anchor" id="autotoc_md23"></a>
Use:</h4>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="preprocessor">#include &quot;vipra.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line">VIPRA::simulation(</div>
<div class="line">  ...</div>
<div class="line">  <a class="code hl_class" href="d8/df7/classVIPRA_1_1Pedestrians_1_1Grid.html">VIPRA::Pedestrians::Grid</a>{},</div>
<div class="line">  ...</div>
<div class="line">);</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md24"></a>
Parameters:</h4>
<ul>
<li><code>gridSize</code>: Size of each grid cell</li>
</ul>
<h3><a class="anchor" id="autotoc_md25"></a>
JSON Input</h3>
<p>This <code>Input</code> module loads JSON data, using <a href="https://github.com/nlohmann/json">nlohmann JSON</a>.</p><ul>
<li>Qualifies as a:<ul>
<li>Polygon Input</li>
<li>Parameter Input</li>
</ul>
</li>
</ul>
<h4><a class="anchor" id="autotoc_md26"></a>
Use:</h4>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="preprocessor">#include &quot;vipra.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line">VIPRA::simulation(</div>
<div class="line">  ...</div>
<div class="line">  <a class="code hl_class" href="d2/d41/classVIPRA_1_1Module_1_1Map.html">VIPRA::Module::Map</a> {</div>
<div class="line">    <a class="code hl_class" href="d1/d4b/classVIPRA_1_1Input_1_1JSON.html">VIPRA::Input::JSON</a>{<span class="stringliteral">&quot;filepath&quot;</span>} <span class="comment">// Input modules are usually used in other modules</span></div>
<div class="line">    ...</div>
<div class="line">  }</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line">sim(<a class="code hl_class" href="dd/d44/classVIPRA_1_1Parameters.html">VIPRA::Parameters</a>{</div>
<div class="line">  <a class="code hl_class" href="d1/d4b/classVIPRA_1_1Input_1_1JSON.html">VIPRA::Input::JSON</a>{<span class="stringliteral">&quot;filepath&quot;</span>} <span class="comment">// Or for loading parameters</span></div>
<div class="line">});</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md27"></a>
Parameters:</h4>
<ul>
<li>NONE</li>
</ul>
<h3><a class="anchor" id="autotoc_md28"></a>
JSON Output</h3>
<p>This <code>Output</code> module creates a JSON file containing the positions of each pedestrian for each timestep that matches the output frequency in the simulation module parameters.</p>
<h4><a class="anchor" id="autotoc_md29"></a>
Use:</h4>
<div class="fragment"><div class="line"> ++</div>
<div class="line">VIPRA::simulation(</div>
<div class="line">  ...</div>
<div class="line">  <a class="code hl_class" href="d1/dd7/classVIPRA_1_1Module_1_1Output.html">VIPRA::Module::Output</a>{</div>
<div class="line">    <a class="code hl_class" href="d1/d14/classVIPRA_1_1Output_1_1Trajectories_1_1JSON.html">VIPRA::Output::Trajectories::JSON</a>{}</div>
<div class="line">  },</div>
<div class="line">  ...</div>
<div class="line">)</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md30"></a>
Parameters:</h4>
<ul>
<li><code>filename</code>: Name of the output file</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md32"></a>
Common Errors</h1>
<hr  />
<h1><a class="anchor" id="autotoc_md34"></a>
Development</h1>
<h1><a class="anchor" id="autotoc_md35"></a>
Overview</h1>
<h2><a class="anchor" id="autotoc_md36"></a>
Simulation</h2>
<h3><a class="anchor" id="autotoc_md37"></a>
Simulation Steps</h3>
<p>These are the general steps taken when a simulation is run.</p>
<h4><a class="anchor" id="autotoc_md38"></a>
1. VIPRA::simulation</h4>
<p>First a Simulation is constructed using the <code>VIPRA::simulation</code> utility method.</p>
<h4><a class="anchor" id="autotoc_md39"></a>
2. Run Sim</h4>
<p>The simulation is started using either <code>operator()</code> or <code>run_sim()</code>.</p>
<p>These both take a `Parameter Module` as their argument.</p>
<h4><a class="anchor" id="autotoc_md40"></a>
3. Parameters Loaded</h4>
<p>The `Parameter Module` calls <code>load()</code> on it's `Parameter Input` module.</p>
<h4><a class="anchor" id="autotoc_md41"></a>
4. Parameters Registered</h4>
<p>Each Module has its <code>register_params()</code> method called.</p>
<p>This is used to tell the simulation which parameters are required by each module.</p>
<h4><a class="anchor" id="autotoc_md42"></a>
5. Modules Configured</h4>
<p>Each Module has its <code>config()</code> method called.</p>
<p>The loaded parameters are passed in to each module.</p>
<h4><a class="anchor" id="autotoc_md43"></a>
6. Modules Initialized</h4>
<p>The `Map`, `Goals`, `Model`, and `Behavior Model` have their <code>initialize()</code> methods called.</p>
<p>This allows each module to setup any necessary pre-simulation work.</p>
<h4><a class="anchor" id="autotoc_md44"></a>
7. Simulation Run</h4>
<p>The following is run until the `Goals` module simulation goal is met, or until the simulation <code>max_timestep</code> is reached.</p>
<div class="fragment"><div class="line">model.timestep();</div>
<div class="line">behaviors.timestep();</div>
<div class="line">pedestrian_set.update();</div>
<div class="line">goals.update();</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md45"></a>
8. Output</h4>
<p>Finally, each of the `Output` modules <code>write()</code> method is called.</p>
<h2><a class="anchor" id="autotoc_md46"></a>
Module Types</h2>
<p><b>Model</b></p>
<p>`Model` modules are the pedestrian dynamics models that govern how the pedestrians will move during a simulation</p>
<p><b>Goals</b></p>
<p>`Goals` modules handle pathfinding for the simulation</p>
<p><b>Obstacle Set</b></p>
<p>`Obstacle Set` modules hold the geometry of the environment and handle map/pedestrian collision detection</p>
<p><b>Pedestrian Set</b></p>
<p>`Pedestrian Set` modules hold the pedestrian positions/velocities and handle queries to pedestrians (ex. nearest neighbor)</p>
<p><b>Input</b></p>
<p>`Input` modules handle loading input for the simulation. There are several specialized input types:</p><ul>
<li>`Serializable Input` modules are inputs that allow for serialization of their values</li>
<li>`Parameter Input` modules are able to load parameters</li>
<li>`Polygon Input` modules are able to load polygons for use in obstacle sets</li>
</ul>
<p><b>Output</b></p>
<p>`Output` modules handle producing output from the simulation</p>
<p><b>Map</b></p>
<p>The `Map` module is a coordinator, it accepts one `Obstacle Set` and one `Polygon Input`.</p>
<p><b>Output Coordinator</b></p>
<p>The `Output Coordinator` module handles coordinating any number of `Output` modules.</p>
<h2><a class="anchor" id="autotoc_md47"></a>
Parameter Sweep</h2>
<h2><a class="anchor" id="autotoc_md48"></a>
Randomization</h2>
<h2><a class="anchor" id="autotoc_md49"></a>
VIPRA Types</h2>
<h1><a class="anchor" id="autotoc_md50"></a>
Module Implementation</h1>
<blockquote class="doxtable">
<p>&zwj;!!! Important Notes:</p><ul>
<li>These modules are implemented using templates; this means that any method that accepts a module as a parameter is required to be defined in a header file</li>
<li>Every module has helper macros for their required methods, see Macros</li>
<li>For these Interfaces, assume <code>using namespace VIPRA::Concepts</code> </li>
</ul>
</blockquote>
<h1><a class="anchor" id="autotoc_md51"></a>
Base Module Implementation</h1>
<p>Each module is required to implement the following:</p>
<h3><a class="anchor" id="autotoc_md52"></a>
Interface</h3>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keywordtype">void</span> register_params(Params <span class="keyword">auto</span>&amp;);</div>
<div class="line"><span class="keywordtype">void</span> config(Params <span class="keyword">auto</span> <span class="keyword">const</span>&amp;);</div>
</div><!-- fragment --><p>Every Module also requires a name and type tag:</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line">VIPRA_MODULE_NAME(<span class="stringliteral">&quot;**name**&quot;</span>)</div>
<div class="line">VIPRA_MODULE_TYPE(**type**)</div>
</div><!-- fragment --><ul>
<li>Replace <code>**name**</code> with the name for the module; this will be used to pull the correct parameters from input.</li>
<li>Replace <code>**type**</code> with the type of module the class is; available modules are below:</li>
</ul>
<ol type="1">
<li><code>MODEL</code> - Model</li>
<li><code>GOALS</code> - Goals</li>
<li><code>PEDESTRIANS</code> - Pedestrian Set</li>
<li><code>OBSTACLES</code> - Obstacle Set</li>
<li><code>INPUT</code> - Input</li>
<li><code>OUTPUT</code> - Output</li>
</ol>
<h1><a class="anchor" id="autotoc_md53"></a>
Model Implementation</h1>
<p><code>Model</code> modules are the pedestrian dynamics models that govern how the pedestrians will move during a simulation</p>
<h3><a class="anchor" id="autotoc_md54"></a>
Interface</h3>
<p>Along with the Base Module interface, Model modules are required to implement the following methods.</p>
<p>Helper macros can be found in Model Macros</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keywordtype">void</span> initialize(PedsetModule <span class="keyword">auto</span> <span class="keyword">const</span>&amp;, MapModule <span class="keyword">auto</span> <span class="keyword">const</span>&amp;, GoalsModule <span class="keyword">auto</span> <span class="keyword">const</span>&amp;, OutputModule <span class="keyword">auto</span>&amp;);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> timestep(PedsetModule <span class="keyword">auto</span> <span class="keyword">const</span>&amp;, MapModule <span class="keyword">auto</span> <span class="keyword">const</span>&amp;, GoalsModule <span class="keyword">auto</span> <span class="keyword">const</span>&amp;, OutputModule <span class="keyword">auto</span>&amp;, <a class="code hl_struct" href="d4/da2/structVIPRA_1_1State.html">VIPRA::State</a>&amp;, VIPRA::delta_t, VIPRA::timestep);</div>
<div class="ttc" id="astructVIPRA_1_1State_html"><div class="ttname"><a href="d4/da2/structVIPRA_1_1State.html">VIPRA::State</a></div><div class="ttdoc">Struct that holds the updated positions and velocities of all pedestrians.</div><div class="ttdef"><b>Definition</b> state.hpp:13</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md55"></a>
Goals Implementation</h1>
<p><code>Goals</code> modules handle pathfinding for the simulation.</p>
<h3><a class="anchor" id="autotoc_md56"></a>
Interface</h3>
<p>Along with the Base Module interface, Goals modules are required to implement the following methods.</p>
<p>Helper macros can be found in Goals Macros</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keywordtype">void</span> initialize(PedSetModule <span class="keyword">auto</span> <span class="keyword">const</span>&amp;, MapModule <span class="keyword">auto</span> <span class="keyword">const</span>&amp;);</div>
<div class="line"><span class="keywordtype">void</span> update(PedSetModule <span class="keyword">auto</span> <span class="keyword">const</span>&amp;, MapModule <span class="keyword">auto</span> <span class="keyword">const</span>&amp;, VIPRA::delta_t);</div>
<div class="line"><span class="keywordtype">void</span> change_end_goal(VIPRA::idx, <a class="code hl_struct" href="d8/d28/structVIPRA_1_1f3d.html">VIPRA::f3d</a>);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> current_goals() -&gt; std::vector&lt;VIPRA::f3d&gt; <span class="keyword">const</span>&amp;;</div>
<div class="line"><span class="keyword">auto</span> end_goals() -&gt; std::vector&lt;VIPRA::f3d&gt; <span class="keyword">const</span>&amp;;</div>
<div class="line"><span class="keyword">auto</span> current_goal(VIPRA::idx) -&gt; <a class="code hl_struct" href="d8/d28/structVIPRA_1_1f3d.html">VIPRA::f3d</a> <span class="keyword">const</span>&amp;;</div>
<div class="line"><span class="keyword">auto</span> end_goal(VIPRA::idx) -&gt; <a class="code hl_struct" href="d8/d28/structVIPRA_1_1f3d.html">VIPRA::f3d</a> <span class="keyword">const</span>&amp;;</div>
<div class="line"><span class="keyword">auto</span> is_goal_met(VIPRA::idx) -&gt; bool;</div>
<div class="line"><span class="keyword">auto</span> is_sim_goal_met() -&gt; bool;</div>
<div class="line"><span class="keyword">auto</span> time_since_last_goal(VIPRA::idx) -&gt; VIPRA::f_pnt;</div>
<div class="ttc" id="astructVIPRA_1_1f3d_html"><div class="ttname"><a href="d8/d28/structVIPRA_1_1f3d.html">VIPRA::f3d</a></div><div class="ttdef"><b>Definition</b> f3d.hpp:18</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md57"></a>
Obstacle Set Implementation</h1>
<p>Obstacle Set modules hold the geometry of the environment and handle map/pedestrian collision detection.</p>
<h3><a class="anchor" id="autotoc_md58"></a>
Interface</h3>
<p>Along with the Base Module interface, Obstacle Set modules are required to implement the following methods.</p>
<p>Helper macros can be found in Obstacle Set Macros</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keywordtype">void</span> initialize(std::vector&lt;VIPRA::Geometry::Polygon&gt; <span class="keyword">const</span>&amp;, std::vector&lt;std::string&gt; <span class="keyword">const</span>&amp;, std::map&lt;std::string, std::vector&lt;VIPRA::f3d&gt;&gt; <span class="keyword">const</span>&amp;);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> get_object_types() -&gt; std::vector&lt;std::string&gt; <span class="keyword">const</span>&amp;;</div>
<div class="line"><span class="keyword">auto</span> get_objects(std::string <span class="keyword">const</span>&amp;) -&gt; std::vector&lt;VIPRA::f3d&gt; <span class="keyword">const</span>&amp;;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> collision(VIPRA:f3d) -&gt; bool;</div>
<div class="line"><span class="keyword">auto</span> collision(<a class="code hl_class" href="de/df6/classVIPRA_1_1Geometry_1_1Circle.html">VIPRA::Geometry::Circle</a>) -&gt; bool;</div>
<div class="line"><span class="keyword">auto</span> ray_hit(<a class="code hl_struct" href="d8/d28/structVIPRA_1_1f3d.html">VIPRA::f3d</a>, <a class="code hl_struct" href="d8/d28/structVIPRA_1_1f3d.html">VIPRA::f3d</a>) -&gt; VIPRA::f_pnt;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> get_dimensions() -&gt; <a class="code hl_struct" href="d8/d28/structVIPRA_1_1f3d.html">VIPRA::f3d</a>;</div>
<div class="ttc" id="aclassVIPRA_1_1Geometry_1_1Circle_html"><div class="ttname"><a href="de/df6/classVIPRA_1_1Geometry_1_1Circle.html">VIPRA::Geometry::Circle</a></div><div class="ttdef"><b>Definition</b> circle.hpp:7</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md59"></a>
Pedestrian Set Implementation</h1>
<h3><a class="anchor" id="autotoc_md60"></a>
Interface</h3>
<p>Along with the Base Module interface, Obstacle Set modules are required to implement the following methods.</p>
<p>Helper macros can be found in Pedestrian Set Macros</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keyword">auto</span> num_pedestrians() -&gt; VIPRA::size;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> ped_coords(VIPRA::idx) -&gt; <a class="code hl_struct" href="d8/d28/structVIPRA_1_1f3d.html">VIPRA::f3d</a>;</div>
<div class="line"><span class="keyword">auto</span> all_coords() -&gt; std::vector&lt;VIPRA::f3d&gt; <span class="keyword">const</span>&amp;;</div>
<div class="line"><span class="keyword">auto</span> ped_velocity(VIPRA::idx) -&gt; <a class="code hl_struct" href="d8/d28/structVIPRA_1_1f3d.html">VIPRA::f3d</a>;</div>
<div class="line"><span class="keyword">auto</span> all_velocities() -&gt; std::vector&lt;VIPRA::f3d&gt; <span class="keyword">const</span>&amp;;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> update(<a class="code hl_struct" href="d4/da2/structVIPRA_1_1State.html">VIPRA::State</a> <span class="keyword">const</span>&amp;);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md61"></a>
Input Implementation</h1>
<blockquote class="doxtable">
<p>&zwj;!!! Important Note: Inputs should hold off on loading their input until their <code>load</code> method is called. This reduces the amount of I/O during parallel runs. </p>
</blockquote>
<h3><a class="anchor" id="autotoc_md62"></a>
Interface</h3>
<p>Along with the Base Module interface, Input modules are required to implement the following methods.</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> load();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> data_t, <span class="keyword">typename</span>... key_ts&gt;</div>
<div class="line"><span class="keyword">auto</span> get(key_ts <span class="keyword">const</span>&amp;...) -&gt; data_t;</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md63"></a>
Serializable Input Implementation</h4>
<p>Serializable Input modules additionally require:</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keyword">auto</span> serialize() -&gt; std::string;</div>
<div class="line"><span class="keywordtype">void</span> deserialize(std::string <span class="keyword">const</span>&amp;);</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md64"></a>
Parameter Input Implementation</h4>
<p>Parameter Input modules additionally require:</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> data_t, <span class="keyword">typename</span>... key_ts&gt;</div>
<div class="line"><span class="keyword">auto</span> get&lt;VIPRA::Parameter&lt;data_t&gt;&gt;(key_ts <span class="keyword">const</span>&amp;...) -&gt; std::optional&lt;VIPRA::Parameter&lt;data_t&gt;&gt;;</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md65"></a>
Polygon Input Implementation</h4>
<p>Polygon Input modules additionally require:</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span>... key_ts&gt;</div>
<div class="line"><span class="keyword">auto</span> load_polygons(key_ts <span class="keyword">const</span>&amp;...) -&gt; std::optional&lt;std::vector&lt;VIPRA::Geometry::Polygon&gt;&gt;;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md66"></a>
Output Implementation</h1>
<h3><a class="anchor" id="autotoc_md67"></a>
Interface</h3>
<p>Along with the Base Module interface, Output modules are required to implement the following methods.</p>
<p>Helper macros can be found in Output Macros</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keyword">auto</span> write();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> value_t&gt;</div>
<div class="line"><span class="keywordtype">void</span> timestep_value(std::string <span class="keyword">const</span>&amp;, VIPRA::timestep, value_t);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> value_t&gt;</div>
<div class="line"><span class="keywordtype">void</span> ped_timestep_value(VIPRA::idx, VIPRA::timestep, std::string <span class="keyword">const</span>&amp;, value_t);</div>
</div><!-- fragment --> <hr  />
<h1><a class="anchor" id="autotoc_md69"></a>
Model Implementation Example</h1>
<p>In this example we will walk through creating a `Model` module. This Model will simply have pedestrians walking in circles around their initial position.</p>
<ol type="1">
<li>Create Folder and Files We will create the following:<ul>
<li><code>modules/model/example_model</code></li>
<li><code>modules/model/example_model/example_model.hpp</code></li>
</ul>
</li>
<li>Create the model <div class="fragment"><div class="line"> ++</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;vipra.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>Example {</div>
<div class="line"><span class="keyword">class </span>Model {</div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  <span class="comment">// Give the module a name and set its type</span></div>
<div class="line">  VIPRA_MODULE_NAME(<span class="stringliteral">&quot;example_model&quot;</span>)</div>
<div class="line">  VIPRA_MODULE_TYPE(MODEL)</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Add in the parameter registration step, this is where we tell VIPRA what parameters the module needs</span></div>
<div class="line">  VIPRA_REGISTER_STEP { </div>
<div class="line">    VIPRA_REGISTER_PARAM(<span class="stringliteral">&quot;radius&quot;</span>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Add in the configuration step, this is where the module parameters are loaded in</span></div>
<div class="line">  VIPRA_CONFIG_STEP { </div>
<div class="line">    VIPRA_GET_PARAM(<span class="stringliteral">&quot;radius&quot;</span>, _radius); </div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Add in the initialization step, this is run right before the simulation starts</span></div>
<div class="line">  VIPRA_MODEL_INIT_STEP { </div>
<div class="line">    _initialPoints = pedset.all_coords(); </div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Add in the timestep, this is where the model updates the pedestrians state</span></div>
<div class="line">  VIPRA_MODEL_TIMESTEP {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; pedset.num_pedestrians(); ++i) {</div>
<div class="line">      <span class="comment">// Update the pedestrian&#39;s position, to make them move in a circle</span></div>
<div class="line">      state.positions[i] = <a class="code hl_struct" href="d8/d28/structVIPRA_1_1f3d.html">VIPRA::f3d</a>{_initialPoints[i][0] + _radius * std::cos(deltaT * timestep),</div>
<div class="line">                                      _initialPoints[i][1] + _radius * std::sin(deltaT * timestep)};</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> <span class="keyword">private</span>:</div>
<div class="line">  VIPRA::f_pnt  _radius;</div>
<div class="line">  VIPRA::f3dVec _initialPoints;</div>
<div class="line">};</div>
<div class="line">}  <span class="comment">// namespace Example</span></div>
</div><!-- fragment --></li>
<li>Update <code>main.cpp</code> to use our new model</li>
</ol>
<div class="fragment"><div class="line"> ++</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;vipra.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;modules/model/example_model/example_model.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> main() -&gt; <span class="keywordtype">int</span> {</div>
<div class="line">  <span class="keyword">auto</span> sim = VIPRA::simulation(</div>
<div class="line">      Example::Model{},       <span class="comment">// Here is our model being passed in, the rest don&#39;t matter in this example</span></div>
<div class="line">      <a class="code hl_class" href="d1/dd7/classVIPRA_1_1Module_1_1Output.html">VIPRA::Module::Output</a>{</div>
<div class="line">        <a class="code hl_class" href="d1/d14/classVIPRA_1_1Output_1_1Trajectories_1_1JSON.html">VIPRA::Output::Trajectories::JSON</a>{}</div>
<div class="line">      },</div>
<div class="line">      <a class="code hl_class" href="d8/d10/classVIPRA_1_1Goals_1_1AStar.html">VIPRA::Goals::AStar</a>{},</div>
<div class="line">      <a class="code hl_class" href="d8/df7/classVIPRA_1_1Pedestrians_1_1Grid.html">VIPRA::Pedestrians::Grid</a>{</div>
<div class="line">          <a class="code hl_class" href="d1/d4b/classVIPRA_1_1Input_1_1JSON.html">VIPRA::Input::JSON</a>{<span class="stringliteral">&quot;maps/pedestrians/a320/a320_144_pedestrians.json&quot;</span>},</div>
<div class="line">      },</div>
<div class="line">      <a class="code hl_class" href="d2/d41/classVIPRA_1_1Module_1_1Map.html">VIPRA::Module::Map</a>{</div>
<div class="line">        <a class="code hl_class" href="d1/d4b/classVIPRA_1_1Input_1_1JSON.html">VIPRA::Input::JSON</a>{<span class="stringliteral">&quot;maps/obstacles/a320/a320_polygons.json&quot;</span>},</div>
<div class="line">        <a class="code hl_class" href="d7/dc5/classVIPRA_1_1Obstacles_1_1QuadTree.html">VIPRA::Obstacles::QuadTree</a>{}</div>
<div class="line">      }</div>
<div class="line">  );</div>
<div class="line"> </div>
<div class="line">  sim(<a class="code hl_class" href="dd/d44/classVIPRA_1_1Parameters.html">VIPRA::Parameters</a>{<a class="code hl_class" href="d1/d4b/classVIPRA_1_1Input_1_1JSON.html">VIPRA::Input::JSON</a>{<span class="stringliteral">&quot;./examples/module_params.json&quot;</span>}});</div>
<div class="line">}</div>
</div><!-- fragment --><ol type="1">
<li>Update the <code>module_params.json</code></li>
</ol>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;simulation&quot;: {</div>
<div class="line">    &quot;main&quot;: {</div>
<div class="line">      &quot;max_timestep&quot;: 10000,</div>
<div class="line">      &quot;timestep_size&quot;: 0.005,</div>
<div class="line">      &quot;output_frequency&quot;: 100,</div>
<div class="line">      &quot;random_seed&quot;: 12345</div>
<div class="line">    }</div>
<div class="line">  },</div>
<div class="line">  &quot;model&quot;: {     // Since our module is a model we put the parameters under the &quot;model&quot; field</div>
<div class="line">    &quot;example_model&quot;: {  // We add in a field with our module name</div>
<div class="line">      &quot;radius&quot;: 0.2     // Here is our radius parameter</div>
<div class="line">    }</div>
<div class="line">  },</div>
<div class="line">  &quot;goals&quot;: {</div>
<div class="line">    &quot;astar&quot;: {</div>
<div class="line">      &quot;endGoalType&quot;: &quot;exit&quot;,</div>
<div class="line">      &quot;gridSize&quot;: 0.1,</div>
<div class="line">      &quot;closestObstacle&quot;: 0.25,</div>
<div class="line">      &quot;goalRange&quot;: 0.05</div>
<div class="line">    }</div>
<div class="line">  },</div>
<div class="line">  &quot;pedset&quot;: {</div>
<div class="line">    &quot;grid&quot;: {</div>
<div class="line">      &quot;gridSize&quot;: 0.5</div>
<div class="line">    }</div>
<div class="line">  },</div>
<div class="line">  &quot;obstacles&quot;: {</div>
<div class="line">    &quot;quad_tree&quot;: {</div>
<div class="line">      &quot;minQuadSize&quot;: 0.05</div>
<div class="line">    }</div>
<div class="line">  },</div>
<div class="line">  &quot;output&quot;: {</div>
<div class="line">    &quot;coordinator&quot;: {</div>
<div class="line">      &quot;output_dir&quot;: &quot;./output&quot;</div>
<div class="line">    },</div>
<div class="line">    &quot;trajectories_json&quot;: {</div>
<div class="line">      &quot;filename&quot;: &quot;trajectories.json&quot;</div>
<div class="line">    }</div>
<div class="line">  },</div>
<div class="line">  &quot;behavior_model&quot;: {</div>
<div class="line">    &quot;main&quot;: {</div>
<div class="line">      &quot;behaviors_dir&quot;: &quot;./behaviors&quot;,</div>
<div class="line">      &quot;behaviors&quot;: []</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><ol type="1">
<li>Compile Simulation</li>
</ol>
<p>The simulation can be compiled by running </p><div class="fragment"><div class="line">make</div>
</div><!-- fragment --><ol type="1">
<li>Run</li>
</ol>
<p>Run the simulation with </p><div class="fragment"><div class="line">./VIPRA</div>
</div><!-- fragment --><p>The output will be under <code>./output/trajectories.json</code></p>
<hr  />
<h1><a class="anchor" id="autotoc_md71"></a>
Macros</h1>
<p>For reference on how to use these macros, you can look at <code>modules/model/calm_model/calm_model.hpp</code></p>
<h2><a class="anchor" id="autotoc_md72"></a>
Base Module Macros</h2>
<h4><a class="anchor" id="autotoc_md73"></a>
VIPRA_MODULE_TYPE(type)</h4>
<p><code>VIPRA_MODULE_TYPE</code> sets the modules type</p><ul>
<li>MODEL,</li>
<li>GOALS,</li>
<li>INPUT,</li>
<li>OUTPUT,</li>
<li>PEDESTRIANS,</li>
<li>PARAMETERS,</li>
<li>MAP,</li>
<li>OBSTACLES,</li>
</ul>
<div class="fragment"><div class="line"> ++</div>
<div class="line">VIPRA_MODULE_TYPE(MODEL)</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md74"></a>
VIPRA_MODULE_NAME(name)</h4>
<p><code>VIPRA_MODULE_NAME</code> sets the modules name, the name is used to grab the correct parameters.</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keyword">class </span>ExampleModel {</div>
<div class="line">  VIPRA_MODULE_NAME(<span class="stringliteral">&quot;example_model&quot;</span>)</div>
<div class="line">};</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md75"></a>
CHECK_MODULE(type, class)</h4>
<p><code>CHECK_MODULE</code> checks that the class conforms to the module interface.</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keyword">class </span>ExampleModel {</div>
<div class="line">  ...</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">CHECK_MODULE(MODEL, ExampleModel)</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md76"></a>
VIPRA_REGISTER_STEP</h4>
<h4><a class="anchor" id="autotoc_md77"></a>
VIPRA_REGISTER_PARAM</h4>
<p><code>VIPRA_REGISTER_STEP</code> provides the proper function signature for the parameter registration step.</p>
<p><code>VIPRA_REGISTER_PARAM</code> registers a parameter in the parameter registration step.</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keyword">class </span>ExampleModel {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    VIPRA_REGISTER_STEP {</div>
<div class="line">      VIPRA_REGISTER_PARAM(<span class="stringliteral">&quot;example_param&quot;</span>)</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md78"></a>
VIPRA_CONFIG_STEP</h4>
<h4><a class="anchor" id="autotoc_md79"></a>
VIPRA_GET_PARAM</h4>
<h4><a class="anchor" id="autotoc_md80"></a>
VIPRA_GET_ARRAY_PARAM</h4>
<p><code>VIPRA_CONFIG_STEP</code> provides the proper function signature for the module configuration step.</p>
<p><code>VIPRA_GET_PARAM</code> loads the parameter into a variable.</p>
<p><code>VIPRA_GET_ARRAY_PARAM</code> loads an array parameter into a vector.</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keyword">class </span>ExampleModel {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    VIPRA_CONFIG_STEP {</div>
<div class="line">      VIPRA_GET_PARAM(<span class="stringliteral">&quot;meanMass&quot;</span>, _meanMass);</div>
<div class="line">      VIPRA_GET_ARRAY_PARAM(<span class="stringliteral">&quot;array&quot;</span>, _arrayExample);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    VIPRA::f_pnt _meanMass;</div>
<div class="line">    std::vector&lt;std::string&gt; _arrayExample;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md81"></a>
Model Macros</h2>
<h4><a class="anchor" id="autotoc_md82"></a>
VIPRA_MODEL_INIT_STEP</h4>
<p><code>VIPRA_MODEL_INIT_STEP</code> provides the proper function signature for the model initialization step.</p>
<p>It provides the parameters:</p><ul>
<li>pedset: the pedestrian set module</li>
<li>map: the map module</li>
<li>goals: the goals module</li>
<li>output: the output module</li>
<li>engine: randomization engine</li>
</ul>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keyword">class </span>ExampleModel {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    VIPRA_MODEL_INIT_STEP {</div>
<div class="line">      <span class="comment">// initialize model values</span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md83"></a>
VIPRA_MODEL_TIMESTEP</h4>
<p><code>VIPRA_MODEL_TIMESTEP</code> provides the proper function signature for the model timestep step.</p>
<p>It provides the parameters:</p><ul>
<li>pedset: the pedestrian set module</li>
<li>map: the map module</li>
<li>goals: the goals module</li>
<li>output: the output module</li>
<li>state: the [<code>State</code>] object to update</li>
<li>deltaT: the size of a timestep</li>
<li>timestep: the current timestep number</li>
</ul>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keyword">class </span>ExampleModel {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    VIPRA_MODEL_TIMESTEP {</div>
<div class="line">      <span class="comment">// calculate pedestrian movement</span></div>
<div class="line">      <span class="comment">// update state parameter</span></div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md84"></a>
Goals Macros</h2>
<h4><a class="anchor" id="autotoc_md85"></a>
VIPRA_GOALS_INIT_STEP</h4>
<p><code>VIPRA_GOALS_INIT_STEP</code> provides the proper function signature for the goals initialization step.</p>
<p>It provides the parameters:</p><ul>
<li>pedset: the pedestrian set module</li>
<li>map: the map module</li>
</ul>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keyword">class </span>ExampleGoals {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    VIPRA_GOALS_INIT_STEP {</div>
<div class="line">      <span class="comment">// initialize pedestrian paths</span></div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md86"></a>
Algorithms</h1>
<h1><a class="anchor" id="autotoc_md87"></a>
Data Structures</h1>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"/>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
